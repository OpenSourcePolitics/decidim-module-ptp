<% filter_sections = [] unless local_assigns.has_key?(:filter_sections) %>
<% search_label = t("decidim.searches.filters.search") unless local_assigns.has_key?(:search_label) %>

<% if filter_sections.present? || local_assigns.has_key?(:search_variable) %>
  <%= filter_form_for filter, url_for, class: "new_filter self-stretch", style: "width:90vw;margin:0 auto", data: { filters: "", component: "accordion" } do |form| %>

    <button id="dropdown-trigger-filters" data-component="dropdown" data-target="dropdown-menu-filters" data-open-md="true">
      <%= icon "arrow-down-s-line" %>
      <%= icon "arrow-up-s-line" %>
      <span>
        <%= local_assigns.has_key?(:search_variable) ? t("filter_and_search", scope: "decidim.searches.filters_small_view") : t("filter", scope: "decidim.searches.filters_small_view") %>
      </span>
    </button>

    <div id="dropdown-menu-filters" class="custom-filters" style="flex-direction:row;">
      <%# if local_assigns.has_key?(:skip_to_id) %>
        <%#= link_to t("skip", scope: "decidim.shared.filter_form_help"), "##{skip_to_id}", class: "filter-skip", role: "menuitem" %>
      <%# end %>
      <!--<p class="filter-help" role="menuitem" aria-disabled="true"><%= t("help", scope: "decidim.shared.filter_form_help") %></p>-->
      <% if local_assigns.has_key?(:search_variable) %>
        <div class="filter-search filter-container" role="menuitem" style="width:20%;max-height:fit-content">
          <%= form.search_field search_variable,
                                label: false,
                                placeholder: search_label,
                                title: search_label,
                                "aria-label": search_label %>
          <button type="submit" aria-label="<%= search_label %>">
            <%= icon "search-line" %>
          </button>
        </div>
      <% end %>

      <% filter_sections.each do |f| %>
        <%= form.collection_filter(**f) %>
      <% end %>
      <%= yield %>
    </div>

  <% end %>
<% end %>
<script>
  window.addEventListener("load", (event) => {
    const categoryMenu = document.querySelector('#trigger-menu-category')
    if (categoryMenu != null){
      console.log('inside cat√©')
      categoryMenu.setAttribute("aria-expanded", "false")
      document.querySelector('#panel-dropdown-menu-category').setAttribute("aria-hidden", "true")
    }
    const categoryScope = document.querySelector('#trigger-menu-scope')
    if (categoryScope != null){
      categoryScope.setAttribute("aria-expanded", "false")
      document.querySelector('#panel-dropdown-menu-scope').setAttribute("aria-hidden", "true")
    }
  });
</script>
